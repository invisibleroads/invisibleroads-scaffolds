function getTipByName(b){var d={};b.each(function(){d[this.name]=this.title});return d}function setTipByName(b,d){var a=!1;b.each(function(){var b=d[this.name];if(b){var e=$(this);e.prop("title","<span class=error>"+b+"</span>").tooltip().show();a||(e.focus().select(),a=!0)}})}
$.fn.ajaxForm=function(b){var b=$.extend({},{onSubmit:function(){},onResponse:function(){}},b),d=$("[name=ajaxForm]");d.length||(d=$('<iframe name=ajaxForm style="display:none">').appendTo("body"));return $(this).each(function(){var a=$(this);a.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(){b.onSubmit.apply(a[0]);if(!a.find("[type=file]").length)return $.post(a.prop("action"),a.serialize(),function(c){b.onResponse.apply(a[0],
[c])}),!1;d.one("load",function(){var c=d.contents().find("body").text(),e;try{e=eval("("+c+")")}catch(f){$.ajaxSettings.error(null,"parsererror")}b.onResponse.apply(a[0],[e])})})})};$.fn.focusNext=function(b){$(this).keydown(function(d){if(13==d.which)return b.focus(),!1})};
$.fn.prepareForm=function(){function b(){var a=$(this).find(".replace");a.length&&(a.siblings("input").prop("disabled",!0).hide(),a.show())}function d(){var a=$(this).find(".replace");a.length&&(a.hide(),a.siblings("input").prop("disabled",!1).show())}return $(this).each(function(){var a=$(this),c=a.find("[title]"),e=getTipByName(c);c.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var b=this.getTrigger(),c=b.prop("title");
c&&(this.getTip().html(c),b.prop("title",""));this.getConf().offset=[0,a.offset().left+a.outerWidth()-(b.offset().left+b.outerWidth())+10]},onHide:function(){var a=this.getTrigger();a.prop("title",e[a.prop("name")])}});a.ajaxForm({onSubmit:function(){if(!a.find("[name=token]").length)try{a.append('<input name=token type=hidden value="'+token+'">')}catch(b){}a.find(".save").prop("disabled",!0)},onResponse:function(b){a.find(".save").prop("disabled",!1);b.isOk?a.trigger("onSuccess",[b]):b.message?alert(b.message):
setTipByName(c,b.errorByID)}}).bind({showAdd:d,showEdit:b}).find(".replace").click(function(){d.apply($(this).parents("form"),[null])})})};$.fn.prepareOverlayForm=function(){return $(this).prepareForm().each(function(){var b=$(this),d=b.find("[title]"),a=b.find("[name]");b.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){setTipByName(d,{});a.first().focus().select()},onClose:function(){$(".formTip").hide()},closeOnClick:!1});b.bind("onSuccess",function(){b.overlay().close()})})};
$.fn.clickToggle=function(b){function d(a){var b=a.find(".content");b.length&&a.html(b.html())}b=$.extend({},{requiredClass:"",requiredMessage:"",optionalClass:"",onMessage:"",onValue:1,offMessage:"",offValue:0,postURL:"",postAttribute:"",nameClass:"",onSuccess:function(){}},b);return $(this).live({mouseenter:function(){var a=$(this),c=a.parents("tr");a.find(".content").length||a.html('<span class=content style="display:none">'+a.html()+"</span>");a.find(".flag").length||(c.hasClass(b.requiredClass)?
(c=c.hasClass(b.optionalClass)?b.offMessage:b.onMessage,a.append("<span class=flag>"+c+"</span>")):a.append('<span class="flag inactive">'+b.requiredMessage+"</span>"));$(this).css("cursor","pointer")},mouseleave:function(){var a=$(this);d(a);$(this).css("cursor","auto")},click:function(){var a=$(this),c=a.parents("tr");if(c.hasClass(b.requiredClass)){var e=c.hasClass(b.optionalClass),f=e?b.offMessage:b.onMessage;d(a);confirm(f+" "+c.find("."+b.nameClass).text()+"?")&&(f={token:token,id:getID(c[0])},
f[b.postAttribute]=e?b.offValue:b.onValue,$.post(b.postURL,f,function(d){if(d.isOk){var e=c.parents("table");typeof d.content!="undefined"&&e.find("tbody").html(d.content);typeof e.data("dataTableCustom")!="undefined"&&e.dataTableCustom();b.onSuccess.apply(a[0],[d])}else alert(d.message)}))}}})};
if(typeof $.fn.dataTable!="undefined")$.fn.prepareTableOverlayForm=function(b,d){var a=b.prop("id"),c=$("#info");c.length||(c=$("<div>",{id:"info"}).appendTo("body"));return $(this).prepareOverlayForm().each(function(){var e=$(this),f=e.find("[name]"),g=e.find("[name=id]");g.length||(g=$("<input name=id type=hidden>").appendTo(e));typeof d=="undefined"&&(d=$("#"+a+"_wrapper tr"));d.live({mouseenter:function(){var a=$(this);if(a.find("th").length)a="add";else{if(!a.prop("id"))return;a="edit"}c.html("Doubleclick to "+
a);$(this).css("cursor","pointer")},mouseleave:function(){c.html("");$(this).css("cursor","auto")},dblclick:function(){var a=$(this);if(a.find("th").length)f.not("[type=submit],[type=button]").val(""),e.trigger("showAdd",[a]);else{var b=a.prop("id");if(!b)return;f.not("[type=submit],[type=button],[name=id]").each(function(){var b=a.find("."+this.name),c=b.attr("rel");typeof c=="undefined"&&(c=$.trim(b.text()));this.value=c});g.val(getNumber(b));e.trigger("showEdit",[a])}e.overlay().load()}});e.bind("onSuccess",
function(a,c){b.find("tbody").html(c.content);b.dataTableCustom()});e.bind("onClose",function(){$("#"+a+"_filter input").focus()})})},$.fn.dataTableExt.oSort["rel-numeric-asc"]=function(b,d){var a=b.match(/rel="*(-?[0-9]+)/)[1],c=d.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),c=parseFloat(c);return a<c?-1:a>c?1:0},$.fn.dataTableExt.oSort["rel-numeric-desc"]=function(b,d){var a=b.match(/rel="*(-?[0-9]+)/)[1],c=d.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),c=parseFloat(c);return a<c?1:a>c?-1:0},$.fn.dataTableExt.oSort["rel-string-asc"]=
function(b,d){var a=b.match(/rel="(.*?)"/)[1].toLowerCase(),c=d.match(/rel="(.*?)"/)[1].toLowerCase();return a<c?-1:a>c?1:0},$.fn.dataTableExt.oSort["rel-string-desc"]=function(b,d){var a=b.match(/rel="(.*?)"/)[1].toLowerCase(),c=d.match(/rel="(.*?)"/)[1].toLowerCase();return a<c?1:a>c?-1:0},$.fn.dataTableCustom=function(b){b=$.extend({},{aoColumns:null,computeTableHeight:function(){return $("#main").height()-$("#header").height()*2}},b);return $(this).each(function(){var d=$(this),a=d.data("dataTableCustom"),
c,e,f,g;typeof a=="undefined"?(e=[],f=b.aoColumns,g=b.computeTableHeight):(c=a.$dataTable,c.fnClearTable(!1),e=c.fnSettings().aaSorting,f=a.aoColumns,g=a.computeTableHeight);c=d.dataTable({aaSorting:e,aoColumns:f,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:"Filter"},sScrollY:g()});a=d.prop("id");e="resize."+a;$(window).unbind(e).bind(e,function(){c.parents(".dataTables_scrollBody").height(g());c.fnAdjustColumnSizing()});d.data("dataTableCustom",{$dataTable:c,aoColumns:f,computeTableHeight:g});$("#"+
a+"_filter input").focus()})};
