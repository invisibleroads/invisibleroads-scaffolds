function getTipByName(a){var d={};a.each(function(){d[this.name]=this.title});return d}function setTipByName(a,d){var b=!1;a.each(function(){var a=this.name,e=d[a];e&&($(this).prop("title","<span class=error>"+e+"</span>").tooltip().show(),b||($("[name="+a+"]").focus().select(),b=!0))})}
$.fn.ajaxForm=function(a){var a=$.extend({},$.fn.ajaxForm.defaults,a),d=$("[name=ajaxForm]");d.length||(d=$('<iframe name=ajaxForm style="display:none">').appendTo("body"));return $(this).each(function(){var b=$(this);b.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(c){a.onSubmit.apply(b[0]);if(b.find("[type=file]").length)d.one("load",function(){var c=d.contents().find("body").text(),f;try{f=eval("("+c+")")}catch(g){$.ajaxSettings.error(null,
"parsererror")}a.onResponse.apply(b[0],[f])});else c.preventDefault(),$.post(b.prop("action"),b.serialize(),function(c){a.onResponse.apply(b[0],[c])})})})};$.fn.ajaxForm.defaults={onSubmit:function(){},onResponse:function(){}};$.fn.focusNext=function(a){$(this).keydown(function(d){13==d.which&&(d.preventDefault(),a.focus())})};
$.fn.prepareForm=function(){return $(this).each(function(){var a=$(this),d=a.find("[name]"),b=getTipByName(d);d.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var c=this.getTrigger(),b=c.prop("title");b&&(this.getTip().html(b),c.prop("title",""));this.getConf().offset=[0,a.offset().left+a.outerWidth()-(c.offset().left+c.outerWidth())+10]},onHide:function(){var a=this.getTrigger();a.prop("title",b[a.prop("name")])}});a.ajaxForm({onSubmit:function(){if(!a.find("[name=token]").length)try{a.append('<input name=token type=hidden value="'+
token+'">')}catch(b){}a.find(".save").prop("disabled",!0)},onResponse:function(b){b.isOk?a.trigger("onSuccess",[b]):setTipByName(d,b.errorByID);a.find(".save").prop("disabled",!1)}})})};$.fn.prepareOverlayForm=function(){return $(this).prepareForm().each(function(){var a=$(this),d=a.find("[name]");a.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){setTipByName(d,{});d.first().focus().select()},onClose:function(){$(".formTip").hide()},closeOnClick:!1});a.bind("onSuccess",function(){a.overlay().close()})})};
$.fn.clickToggle=function(a){function d(a){var c=a.find(".content");c.length&&a.html(c.html())}a=$.extend({},$.fn.clickToggle.defaults,a);return $(this).live({mouseenter:function(){var b=$(this),c=b.parents("tr");b.find(".content").length||b.html('<span class=content style="display:none">'+b.html()+"</span>");b.find(".flag").length||(c.hasClass(a.requiredClass)?(c=c.hasClass(a.optionalClass)?a.offMessage:a.onMessage,b.append("<span class=flag>"+c+"</span>")):b.append('<span class="flag inactive">'+
a.requiredMessage+"</span>"));$(this).css("cursor","pointer")},mouseleave:function(){var a=$(this);d(a);$(this).css("cursor","auto")},click:function(){var b=$(this),c=b.parents("tr");if(c.hasClass(a.requiredClass)){var e=c.hasClass(a.optionalClass),f=e?a.offMessage:a.onMessage;d(b);confirm(f+" "+c.find("."+a.nameClass).text()+"?")&&(f={token:token,id:getID(c[0])},f[a.postAttribute]=e?a.offValue:a.onValue,$.post(a.postURL,f,function(d){if(d.isOk){var e=c.parents("table");typeof d.content!="undefined"&&
e.find("tbody").html(d.content);typeof e.data("dataTableCustom")!="undefined"&&e.dataTableCustom();a.onSuccess.apply(b[0],[d])}else alert(d.message)}))}}})};$.fn.clickToggle.defaults={requiredClass:"",requiredMessage:"",optionalClass:"",onMessage:"",onValue:1,offMessage:"",offValue:0,postURL:"",postAttribute:"",nameClass:"",onSuccess:function(){}};
if(typeof $.fn.dataTable!="undefined")$.fn.prepareTableOverlayForm=function(a,d){var b=a.prop("id"),c=$("#info");c.length||(c=$("<div>",{id:"info"}).appendTo("body"));return $(this).prepareOverlayForm().each(function(){var e=$(this),f=e.find("[name]"),g=e.find("[name=id]");g.length||(g=$("<input name=id type=hidden>").appendTo(e));typeof d=="undefined"&&(d=$("#"+b+"_wrapper tr"));d.live({mouseenter:function(){var a=$(this);if(a.find("th").length)a="add";else{if(!a.prop("id"))return;a="edit"}c.html("Doubleclick to "+
a);$(this).css("cursor","pointer")},mouseleave:function(){c.html("");$(this).css("cursor","auto")},dblclick:function(){var a=$(this);if(a.find("th").length)f.not("[type=submit],[type=button]").val(""),e.trigger("showAdd",[a]);else{var b=a.prop("id");if(!b)return;f.not("[type=submit],[type=button],[name=id]").each(function(){var b=a.find("."+this.name),c=b.attr("rel");typeof c=="undefined"&&(c=$.trim(b.text()));this.value=c});g.val(getNumber(b));e.trigger("showEdit",[a])}e.overlay().load()}});e.bind("onSuccess",
function(b,c){a.find("tbody").html(c.content);a.dataTableCustom()});e.bind("onClose",function(){$("#"+b+"_filter input").focus()})})},$.fn.dataTableExt.oSort["rel-numeric-asc"]=function(a,d){var b=a.match(/rel="*(-?[0-9]+)/)[1],c=d.match(/rel="*(-?[0-9]+)/)[1],b=parseFloat(b),c=parseFloat(c);return b<c?-1:b>c?1:0},$.fn.dataTableExt.oSort["rel-numeric-desc"]=function(a,d){var b=a.match(/rel="*(-?[0-9]+)/)[1],c=d.match(/rel="*(-?[0-9]+)/)[1],b=parseFloat(b),c=parseFloat(c);return b<c?1:b>c?-1:0},$.fn.dataTableExt.oSort["rel-string-asc"]=
function(a,d){var b=a.match(/rel="(.*?)"/)[1].toLowerCase(),c=d.match(/rel="(.*?)"/)[1].toLowerCase();return b<c?-1:b>c?1:0},$.fn.dataTableExt.oSort["rel-string-desc"]=function(a,d){var b=a.match(/rel="(.*?)"/)[1].toLowerCase(),c=d.match(/rel="(.*?)"/)[1].toLowerCase();return b<c?1:b>c?-1:0},$.fn.dataTableCustom=function(a){a=$.extend({},$.fn.dataTableCustom.defaults,a);return $(this).each(function(){var d=$(this),b=d.data("dataTableCustom"),c,e,f,g;typeof b=="undefined"?(e=[],f=a.aoColumns,g=a.computeTableHeight):
(c=b.$dataTable,c.fnClearTable(!1),e=c.fnSettings().aaSorting,f=b.aoColumns,g=b.computeTableHeight);c=d.dataTable({aaSorting:e,aoColumns:f,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:"Filter"},sScrollY:g()});b=d.prop("id");e="resize."+b;$(window).unbind(e).bind(e,function(){c.parents(".dataTables_scrollBody").height(g());c.fnAdjustColumnSizing()});d.data("dataTableCustom",{$dataTable:c,aoColumns:f,computeTableHeight:g});$("#"+b+"_filter input").focus()})},$.fn.dataTableCustom.defaults={aoColumns:null,
computeTableHeight:function(){return $("#main").height()-$("#header").height()*2}};
