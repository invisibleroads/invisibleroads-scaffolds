var $table,$form,$formObjs,defaultByName={},dataColumns;
function applyDataTable(b){function a(){return $(window).height()-($("tr:first").height()+7)*3}var c;$table?($table.fnClearTable(!1),c=$table.fnSettings().aaSorting):c=[];typeof b!="undefined"&&(dataColumns=b);$table=$("#data").dataTable({aaSorting:c,aoColumns:dataColumns,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:"Filter"},sScrollY:a()});$(window).unbind("resize.table").bind("resize.table",function(){$(".dataTables_scrollBody").height(a());$table.fnAdjustColumnSizing()});$("#data_filter input").focus()}
function applyFlag(b,a,c,d,e,f,h,i,j,k,l){$(b).live({mouseenter:function(){var b=$(this),g=b.parent("tr");b.find(".text").hide();g.hasClass(a)?(g=g.hasClass(d)?h:e,b.append("<span class=flag>"+g+"</span>")):b.append('<span class="flag inactive">'+c+"</span>")},mouseleave:function(){var a=$(this);a.find(".flag").remove();a.find(".text").show()},click:function(){var b=$(this).parent("tr");if(b.hasClass(a)){var c=b.hasClass(d);if(confirm((c?h:e)+" "+b.find("."+l).text()+"?"))b={token:token,id:getID(b[0])},
b[k]=c?i:f,$.post(j,b,function(a){a.isOk?($table.find("tbody").html(a.content),applyDataTable()):alert(a.message)})}}})}
$.fn.ajaxForm=function(b){var b=$.extend({},$.fn.ajaxForm.defaults,b),a=$("#ajaxForm"),c=$(this);a.length||(a=$("<iframe>",{name:"ajaxForm",style:"display:none"}),$("body").append(a));return c.each(function(){var c=$(this);c.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(){b.prepare.apply(c[0]);a.one("load",function(){var e=a.contents().find("body").text(),f;try{f=eval("("+e+")")}catch(h){$.ajaxSettings.error(void 0,"parsererror")}b.success.apply(c[0],
[f])})})})};$.fn.ajaxForm.defaults={prepare:function(){},success:function(){}};
function loadForm(b){$form=$("#form");$formObjs=$form.find(".field");$formObjs.each(function(){defaultByName[this.name]=this.title});$("body").append("<div id=info></div>");typeof b=="undefined"&&(b=".dataTables_scroll tr");$(b).live({mouseenter:function(){var a=$(this).prop("id");a&&(a=a=="row0"?"add":"edit",$("#info").html("Doubleclick to "+a))},mouseleave:function(){$("#info").html("")},dblclick:function(){var a=$(this),b=a.prop("id");b&&(b=="row0"?($formObjs.val(""),$form.find("[name=id]").val("").trigger("showAdd",
[a])):($formObjs.each(function(){var b=a.find("."+this.name),c=b.attr("rel");typeof c=="undefined"&&(c=$.trim(b.text()));this.value=c}),$form.find("[name=id]").val(getNumber(b)).trigger("showEdit",[a])),$form.overlay().load())}});$form.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){showFormMessages($formObjs,{});$formObjs.first().focus().select()},onClose:function(){$(".formTip").hide();$("#data_filter input").focus()},closeOnClick:!1});$form.ajaxForm({prepare:function(){$form.find("[name=token]").length||
$form.append('<input name=token type=hidden value="'+token+'">');$form.find(".save").prop("disabled",!0)},success:function(a){a.isOk?($form.overlay().close(),$table.find("tbody").html(a.content),applyDataTable()):showFormMessages($formObjs,a.errorByID);$form.find(".save").prop("disabled",!1)}});$formObjs.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var a=this.getTrigger(),b=a.prop("title");b&&(this.getTip().html(b),a.prop("title",
""));this.getConf().offset=[0,$form.offset().left+$form.outerWidth()-(a.offset().left+a.outerWidth())+10]},onHide:function(){var a=this.getTrigger();a.prop("title",defaultByName[a.prop("name")])}});return $form}function showFormMessages(b,a){var c=!1;b.each(function(){var b=this.name,e=a[b];e&&($(this).prop("title","<span class=error>"+e+"</span>").tooltip().show(),c||($("[name="+b+"]").focus().select(),c=!0))})}
$.fn.dataTableExt.oSort["rel-asc"]=function(b,a){var c=b.match(/rel="(.*?)"/)[1].toLowerCase(),d=a.match(/rel="(.*?)"/)[1].toLowerCase();return c<d?-1:c>d?1:0};$.fn.dataTableExt.oSort["rel-desc"]=function(b,a){var c=b.match(/rel="(.*?)"/)[1].toLowerCase(),d=a.match(/rel="(.*?)"/)[1].toLowerCase();return c<d?1:c>d?-1:0};
