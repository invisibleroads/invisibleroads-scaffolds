function alertError(c){var a=c;if("object"==typeof c){var a=[],b;for(b in c)a.push(b+": "+c[b]);a=a.join("\n")}alert(a)}function getTipByName(c){var a={};c.each(function(){a[this.name||this.id||this.className]=this.title});return a}function setTipByName(c,a){var b=!1;c.each(function(){var d=a[this.name||this.id||this.className];if(d){var c=$(this);setTip(c,d);c.is(":visible")&&(c.tooltip().show(),b||(c.focus().select(),b=!0))}});return b}
function setTip(c,a){var b=c.tooltip(),d="<span class=error>"+a+"</span>";b.isShown()?b.getTip().html(d):c.prop("title",d)}
$.fn.ajaxForm=function(c){var c=$.extend({},{onSubmit:function(){},onResponse:function(){}},c),a=$("[name=ajaxForm]");a.length||(a=$('<iframe name=ajaxForm style="display:none">').appendTo("body"));return $(this).each(function(){var b=$(this);b.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(){c.onSubmit.apply(b[0]);a.one("load",function(){var d=a.contents().find("body").text(),f;try{f=eval("("+d+")")}catch(e){$.ajaxSettings.error&&
$.ajaxSettings.error(null,"parsererror")}c.onResponse.apply(b[0],[f])})})})};$.fn.focusNext=function(c){$(this).keydown(function(a){if(13==a.which)return c.focus(),!1})};
$.fn.prepareForm=function(){function c(){var b=$(this).find(".replace");b.length&&(b.siblings("[type=file]").hide().prop("disabled",!0),b.show())}function a(){var b=$(this).find(".replace");b.length&&(b.hide(),b.siblings("[type=file]").show().removeAttr("disabled"))}return $(this).each(function(){var b=$(this);b.find(".token-input-input-token input").each(function(){var a=$(this),d=/token-input-(.*)/.exec(a.prop("id"))[1],d=b.find("[name="+d+"]");a.prop("title",d.prop("title"))});var d=b.find("[title]"),
f=getTipByName(d);d.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var a=this.getTrigger(),d=a.prop("title");d&&(this.getTip().html(d),a.prop("title",""));this.getConf().offset=[0,10-(a.offset().left+a.outerWidth())+(b.offset().left+b.outerWidth())]},onHide:function(){var b=this.getTrigger();b.prop("title",f[b.prop("name")||b.prop("id")||b.prop("className")])}});var e=b.find(".tabs");if(e.length){var g=e.tabs(".panes > div",
{onClick:function(a,d){b.is(":visible")&&(b.find("[name]").not(":visible").each(function(){$(this).tooltip().hide()}),this.getPanes().eq(d).find("input,select,textarea").filter(":visible").first().focus())}}).data("tabs");b.on("onBeforeError",function(b,a){var d=a.errorByName;for(f in d){var c=$("[name="+f+"]");if(c.length){c=c.parents(".panes > div");g.click(c.parent().children().index(c));break}}for(var f in d){var e="token-input-"+f,c=$("#"+e);c.length&&(d[e]=d[f])}})}b.ajaxForm({onSubmit:function(){if("undefined"!=
typeof token&&!b.find("[name=token]").length)try{b.append('<input name=token type=hidden value="'+token+'">')}catch(a){}b.find("[type=submit]").tooltip().getTip().hide()},onResponse:function(a){a||(a={message:"Whoops! You have found a bug."});a.isOk?b.trigger("onSuccess",[a]):a.message?alert(a.message):!1!=b.triggerHandler("onBeforeError",[a])&&(setTipByName(d,a.errorByName)||alertError(a.errorByName))}}).on({showAdd:a,showEdit:c,onLoad:function(){$(this).find("[type=file]").siblings("[type=hidden]").prop("disabled",
!0).val("")},onBeforeError:function(a,b){var d=$(this),c=b.uploadIDByName,f;for(f in c){var e=d.find("[name="+f+"]");e.filter("[type=file]").hide().prop("disabled",!0);e.filter("[type=hidden]").removeAttr("disabled").val(c[f]);e.siblings(".replace").show()}}}).find(".replace").click(function(){var a=$(this);a.hide();a.siblings("[type=file]").show().removeAttr("disabled");a.siblings("[type=hidden]").prop("disabled",!0)})})};
$.fn.prepareOverlayForm=function(){return $(this).prepareForm().each(function(){var c=$(this);c.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){c.find("input,select,textarea").filter(":visible").first().focus().select()},onClose:function(){$(".formTip").hide()}});c.on("onSuccess",function(){c.overlay().close()})})};
$.fn.cellToggle=function(c,a){function b(a){a.css("cursor","auto").removeClass("white").find(".flag").remove()}a=$.extend({},{requiredClass:"",requiredMessage:"",optionalClass:"",onMessage:"",onValue:1,offMessage:"",offValue:0,requestURL:"",requestAttribute:"",requestMethod:"POST",nameClass:"",onSuccess:function(){}},a);return $(this).on({mouseenter:function(){var b=$(this);b.css("cursor","pointer");if(!b.find(".flag").length){var c=b.position(),e=b.parents("tr");e.hasClass(a.requiredClass)?(e=e.hasClass(a.optionalClass)?
a.offMessage:a.onMessage,e=$("<div class=flag>"+e+"</div>")):e=$('<div class="flag inactive">'+a.requiredMessage+"</div>");b.addClass("white");e.css({position:"absolute",top:c.top,left:c.left,width:b.width(),height:b.height()}).appendTo(b)}},mouseleave:function(){b($(this))},click:function(){var c=$(this),f=c.parents("tr");if(f.hasClass(a.requiredClass)){var e=f.hasClass(a.optionalClass),g=e?a.offMessage:a.onMessage;b(c);if(a.nameClass?confirm(g+" "+f.find("."+a.nameClass).text()+"?"):1){var h=getID(f[0]),
i=a.requestMethod.toLowerCase(),g={id:h},h="function"==typeof a.requestURL?a.requestURL(f,h):a.requestURL.replace(0,h);"undefined"!=typeof token&&(g.token=token);a.requestAttribute&&(g[a.requestAttribute]=e?a.offValue:a.onValue);if(i)$[i](h,g,function(b){if(b.isOk){var e=f.parents("table");"undefined"!=typeof b.content&&(e.find("tbody").html(b.content),"undefined"!=typeof e.data("dataTableCustom")&&e.dataTableCustom());a.onSuccess.apply(c[0],[b])}else alertError(b.message)});else{e=[];for(key in g)e.push(key+
"="+g[key]);window.location=h+"?"+e.join("&")}}}}},c)};
"undefined"!=typeof $.fn.dataTable&&($.fn.prepareTableOverlayForm=function(c,a){var b=c.prop("id"),d;return $(this).prepareOverlayForm().each(function(){var f=$(this).on("onSuccess",function(b,a){c.find("tbody").html(a.content);c.dataTableCustom()}).on("onClose",function(){$("#"+b+"_filter input").focus()}),e=f.find("[name]"),g=f.find("[name=id]");g.length||(g=$("<input name=id type=hidden>").appendTo(f));var h="#"+b+"_add";if($(h).length)$(document).off("click",h).on("click",h,function(){e.not("[type=submit],[type=button]").val("");
g.val("");f.trigger("showAdd").overlay().load()});c.on({mouseenter:function(){if($(this).prop("id")){var a=$("#"+b+"_info");d=a.html();a.html("Doubleclick to edit");$(this).css("cursor","pointer")}},mouseleave:function(){$("#"+b+"_info").html(d);$(this).css("cursor","auto")},dblclick:function(){var b=$(this),a=b.prop("id");a&&(e.not("[type=submit],[type=button],[name=id]").each(function(){var a=b.find("."+this.name),c=a.attr("rel");"undefined"==typeof c&&(c=$.trim(a.text()));this.value=c}),g.val(getNumber(a)),
f.trigger("showEdit",[b]).overlay().load())}},a||"tr")})},$.fn.dataTableExt.oSort["rel-numeric-asc"]=function(c,a){var b=c.match(/rel="*(-?[0-9]+)/)[1],d=a.match(/rel="*(-?[0-9]+)/)[1],b=parseFloat(b),d=parseFloat(d);return b<d?-1:b>d?1:0},$.fn.dataTableExt.oSort["rel-numeric-desc"]=function(c,a){var b=c.match(/rel="*(-?[0-9]+)/)[1],d=a.match(/rel="*(-?[0-9]+)/)[1],b=parseFloat(b),d=parseFloat(d);return b<d?1:b>d?-1:0},$.fn.dataTableExt.oSort["rel-string-asc"]=function(c,a){var b=c.match(/rel="(.*?)"/)[1].toLowerCase(),
d=a.match(/rel="(.*?)"/)[1].toLowerCase();return b<d?-1:b>d?1:0},$.fn.dataTableExt.oSort["rel-string-desc"]=function(c,a){var b=c.match(/rel="(.*?)"/)[1].toLowerCase(),d=a.match(/rel="(.*?)"/)[1].toLowerCase();return b<d?1:b>d?-1:0},$.fn.dataTableCustom=function(c){c=$.extend({},{aoColumns:null,computeTableHeight:function(){return $("#main").height()-2*$("#header").height()},onLoad:function(){}},c);return $(this).each(function(){var a=$(this),b=a.data("dataTableCustom"),d,f,e,g;"undefined"==typeof b?
(f=[],e=c.aoColumns,g=c.computeTableHeight,onLoad=c.onLoad):(d=b.$dataTable,d.fnClearTable(0),f=d.fnSettings().aaSorting,e=b.aoColumns,g=b.computeTableHeight,onLoad=b.onLoad);d=a.dataTable({aaSorting:f,aoColumns:e,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:""},sScrollY:g()});b=a.prop("id");f="resize."+b;$(window).off(f).on(f,function(){d.parents(".dataTables_scrollBody").height(g());d.fnAdjustColumnSizing()});$("#"+b+"_filter input").prop("placeholder","Filter results").focus();a.data("dataTableCustom",
{$dataTable:d,aoColumns:e,computeTableHeight:g,onLoad:onLoad});onLoad.apply(a[0])})});