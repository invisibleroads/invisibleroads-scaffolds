(function(b){var B,y,v,C={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsFormatter:function(b){return"<li>"+b[this.propertyToSearch]+"</li>"},tokenFormatter:function(b){return"<li><p>"+b[this.propertyToSearch]+"</p></li>"},tokenLimit:null,
tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},D={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",
inputToken:"token-input-input-token",disabled:"token-input-disabled"};B=0;y=1;v=2;var k={init:function(i,j){var a=b.extend({},C,j||{});return this.each(function(){b(this).data("tokenInputObject",new b.TokenList(this,i,a))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(b){this.data("tokenInputObject").add(b);return this},remove:function(b){this.data("tokenInputObject").remove(b);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(b){this.data("tokenInputObject").toggleDisabled(b);
return this}};b.fn.tokenInput=function(b){return k[b]?k[b].apply(this,Array.prototype.slice.call(arguments,1)):k.init.apply(this,arguments)};b.TokenList=function(i,j,a){function J(e){a.disabled="boolean"===typeof e?e:!a.disabled;g.prop("disabled",a.disabled);l.toggleClass(a.classes.disabled,a.disabled);c&&s(b(c),v);h.prop("disabled",a.disabled)}function K(){null!==a.tokenLimit&&m>=a.tokenLimit&&(g.hide(),q())}function L(e){var d=a.tokenFormatter(e),d=b(d).addClass(a.classes.token).insertBefore(r);
b("<span>"+a.deleteText+"</span>").addClass(a.classes.tokenDelete).appendTo(d).click(function(){if(!a.disabled)return z(b(this).parent()),h.change(),!1});b.data(d.get(0),"tokeninput",e);n=n.slice(0,o).concat([e]).concat(n.slice(o));o++;M(n,h);m+=1;null!==a.tokenLimit&&m>=a.tokenLimit&&(g.hide(),q());return d}function k(e){var d=a.onAdd;if(0<m&&a.preventDuplicates){var f=null;l.children().each(function(){var a=b(this),d=b.data(a.get(0),"tokeninput");if(d&&d.id===e.id)return f=a,!1});if(f){x(f);r.insertAfter(f);
u(g);return}}if(null==a.tokenLimit||m<a.tokenLimit)L(e),K();g.val("");q();b.isFunction(d)&&d.call(h,e)}function x(b){a.disabled||(b.addClass(a.classes.selectedToken),c=b.get(0),g.val(""),q())}function s(b,d){b.removeClass(a.classes.selectedToken);c=null;d===B?(r.insertBefore(b),o--):d===y?(r.insertAfter(b),o++):(r.appendTo(l),o=m);u(g)}function z(e){var d=b.data(e.get(0),"tokeninput"),f=a.onDelete,w=e.prevAll().length;w>o&&w--;e.remove();c=null;u(g);n=n.slice(0,w).concat(n.slice(w+1));w<o&&o--;M(n,
h);m-=1;null!==a.tokenLimit&&(g.show().val(""),u(g));b.isFunction(f)&&f.call(h,d)}function M(e,d){var f=b.map(e,function(b){return"function"==typeof a.tokenValue?a.tokenValue.call(this,b):b[a.tokenValue]});d.val(f.join(a.tokenDelimiter))}function q(){t.hide().empty();p=null}function A(){t.css({position:"absolute",top:b(l).offset().top+b(l).outerHeight(),left:b(l).offset().left,width:b(l).outerWidth(),"z-index":a.zindex}).show()}function E(e,d){if(d&&d.length){t.empty();var f=b("<ul>").appendTo(t).mouseover(function(a){F(b(a.target).closest("li"))}).mousedown(function(a){k(b(a.target).closest("li").data("tokeninput"));
h.change();return!1}).hide();b.each(d,function(d,g){var c=a.resultsFormatter(g),c=c.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+g[a.propertyToSearch]+")(?![^<>]*>)(?![^&;]+;)","g"),g[a.propertyToSearch].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")),c=b(c).appendTo(f);d%2?c.addClass(a.classes.dropdownItem):c.addClass(a.classes.dropdownItem2);0===d&&F(c);b.data(c.get(0),"tokeninput",g)});A();a.animateDropdown?f.slideDown("fast"):f.show()}else a.noResultsText&&
(t.html("<p>"+a.noResultsText+"</p>"),A())}function F(e){e&&(p&&(b(p).removeClass(a.classes.selectedDropdownItem),p=null),e.addClass(a.classes.selectedDropdownItem),p=e.get(0))}function N(){var e=g.val();e&&e.length&&(c&&s(b(c),y),e.length>=a.minChars?(a.searchingText&&(t.html("<p>"+a.searchingText+"</p>"),A()),clearTimeout(O),O=setTimeout(function(){C(e)},a.searchDelay)):q())}function C(e){var d=e+G(),f=H.get(d);if(f)E(e,f);else if(a.url){var f=G(),c={data:{}};-1<f.indexOf("?")?(f=f.split("?"),c.url=
f[0],f=f[1].split("&"),b.each(f,function(a,b){var e=b.split("=");c.data[e[0]]=e[1]})):c.url=f;c.data[a.queryParam]=e;c.type=a.method;c.dataType=a.contentType;a.crossDomain&&(c.dataType="jsonp");c.success=function(c){b.isFunction(a.onResult)&&(c=a.onResult.call(h,c));H.add(d,a.jsonContainer?c[a.jsonContainer]:c);g.val()===e&&E(e,a.jsonContainer?c[a.jsonContainer]:c)};b.ajax(c)}else a.local_data&&(f=b.grep(a.local_data,function(b){return-1<b[a.propertyToSearch].toLowerCase().indexOf(e.toLowerCase())}),
b.isFunction(a.onResult)&&(f=a.onResult.call(h,f)),H.add(d,f),E(e,f))}function G(){var b=a.url;"function"==typeof a.url&&(b=a.url.call(a));return b}function u(a){setTimeout(function(){a.focus()},50)}"string"===b.type(j)||"function"===b.type(j)?(a.url=j,j=G(),void 0===a.crossDomain&&"string"===typeof j&&(a.crossDomain=-1===j.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==j.split(/\/+/g)[1])):"object"===typeof j&&(a.local_data=j);a.classes?a.classes=b.extend({},D,a.classes):a.theme?(a.classes={},
b.each(D,function(b,d){a.classes[b]=d+"-"+a.theme})):a.classes=D;var n=[],m=0,H=new b.TokenList.Cache,O,I,g=b('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",a.idPrefix+i.id).focus(function(){if(a.disabled)return!1;if((null===a.tokenLimit||a.tokenLimit!==m)&&a.hintText)t.html("<p>"+a.hintText+"</p>"),A()}).blur(function(){q();b(this).val("")}).bind("keyup keydown blur update",function(){if(I!==(I=g.val())){var a=I.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,
"&gt;");P.html(a);g.width(P.width()+30)}}).keydown(function(a){var d,f;switch(a.keyCode){case 37:case 39:case 38:case 40:return b(this).val()?(d=null,d=40===a.keyCode||39===a.keyCode?b(p).next():b(p).prev(),d.length&&F(d)):(d=r.prev(),f=r.next(),d.length&&d.get(0)===c||f.length&&f.get(0)===c?37===a.keyCode||38===a.keyCode?s(b(c),B):s(b(c),y):(37===a.keyCode||38===a.keyCode)&&d.length?x(b(d.get(0))):(39===a.keyCode||40===a.keyCode)&&f.length&&x(b(f.get(0)))),!1;case 8:d=r.prev();if(b(this).val().length)1===
b(this).val().length?q():setTimeout(function(){N()},5);else return c?(z(b(c)),h.change()):d.length&&x(b(d.get(0))),!1;break;case 9:case 13:case 108:case 188:if(p)return k(b(p).data("tokeninput")),h.change(),!1;break;case 27:return q(),!0;default:String.fromCharCode(a.which)&&setTimeout(function(){N()},5)}}),h=b(i).hide().val("").focus(function(){u(g)}).blur(function(){g.blur()}),c=null,o=0,p=null,l=b("<ul />").addClass(a.classes.tokenList).click(function(a){if((a=b(a.target).closest("li"))&&a.get(0)&&
b.data(a.get(0),"tokeninput")){var d=c;c&&s(b(c),v);d===a.get(0)?s(a,v):x(a)}else c&&s(b(c),v),u(g)}).mouseover(function(e){(e=b(e.target).closest("li"))&&c!==this&&e.addClass(a.classes.highlightedToken)}).mouseout(function(e){(e=b(e.target).closest("li"))&&c!==this&&e.removeClass(a.classes.highlightedToken)}).insertBefore(h),r=b("<li />").addClass(a.classes.inputToken).appendTo(l).append(g),t=b("<div>").addClass(a.classes.dropdown).appendTo("body").hide(),P=b("<tester/>").insertAfter(g).css({position:"absolute",
top:-9999,left:-9999,width:"auto",fontSize:g.css("fontSize"),fontFamily:g.css("fontFamily"),fontWeight:g.css("fontWeight"),letterSpacing:g.css("letterSpacing"),whiteSpace:"nowrap"});h.val("");i=a.prePopulate||h.data("pre");a.processPrePopulate&&b.isFunction(a.onResult)&&(i=a.onResult.call(h,i));i&&i.length&&b.each(i,function(a,b){L(b);K()});a.disabled&&J(!0);b.isFunction(a.onReady)&&a.onReady.call();this.clear=function(){l.children("li").each(function(){0===b(this).children("input").length&&z(b(this))})};
this.add=function(a){k(a)};this.remove=function(a){l.children("li").each(function(){if(0===b(this).children("input").length){var d=b(this).data("tokeninput"),c=!0,g;for(g in a)if(a[g]!==d[g]){c=!1;break}c&&z(b(this))}})};this.getTokens=function(){return n};this.toggleDisabled=function(a){J(a)}};b.TokenList.Cache=function(i){var j=b.extend({max_size:500},i),a={},k=0;this.add=function(b,i){k>j.max_size&&(a={},k=0);a[b]||(k+=1);a[b]=i};this.get=function(b){return a[b]}}})(jQuery);
