function alertError(b){var c=b;if("object"==typeof b){var c=[],a;for(a in b)c.push(a+": "+b[a]);c=c.join("\n")}alert(c)}function getTipByName(b){var c={};b.each(function(){c[this.name||this.className]=this.title});return c}function setTipByName(b,c){var a=!1;b.each(function(){if(c[this.name||this.className]){var b=$(this);b.is(":visible")&&(b.tooltip().show(),a||(b.focus().select(),a=!0))}});return a}
function setTip(b,c){var a=b.tooltip(),d="<span class=error>"+c+"</span>";a.isShown()?a.getTip().html(d):b.prop("title",d)}
$.fn.ajaxForm=function(b){var b=$.extend({},{onSubmit:function(){},onResponse:function(){}},b),c=$("[name=ajaxForm]");c.length||(c=$('<iframe name=ajaxForm style="display:none">').appendTo("body"));return $(this).each(function(){var a=$(this);a.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(){b.onSubmit.apply(a[0]);if(!a.find("[type=file]").length)return $.post(a.prop("action"),a.serialize(),function(d){b.onResponse.apply(a[0],
[d])}),!1;c.one("load",function(){var d=c.contents().find("body").text(),e;try{e=eval("("+d+")")}catch(f){$.ajaxSettings.error(null,"parsererror")}b.onResponse.apply(a[0],[e])})})})};$.fn.focusNext=function(b){$(this).keydown(function(c){if(13==c.which)return b.focus(),!1})};
$.fn.prepareForm=function(){function b(){var a=$(this).find(".replace");a.length&&(a.siblings("input").prop("disabled",!0).hide(),a.show())}function c(){var a=$(this).find(".replace");a.length&&(a.hide(),a.siblings("input").prop("disabled",!1).show())}return $(this).each(function(){var a=$(this),d=a.find("[title]"),e=getTipByName(d);d.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var b=this.getTrigger(),d=b.prop("title");
d&&(this.getTip().html(d),b.prop("title",""));this.getConf().offset=[0,10-(b.offset().left+b.outerWidth())+(a.offset().left+a.outerWidth())]},onHide:function(){var a=this.getTrigger();a.prop("title",e[a.prop("name")||a.prop("className")])}});var f=a.find(".tabs");if(f.length){var g=f.tabs(".panes > div",{onClick:function(b,d){a.is(":visible")&&(a.find("[name]").not(":visible").each(function(){$(this).tooltip().hide()}),this.getPanes().eq(d).find("input,select,textarea").filter(":visible").first().focus())}}).data("tabs");
a.bind("onBeforeError",function(a,b){for(name in b.errorByName){var d=$("[name="+name+"]").parents(".panes > div");g.click(d.parent().children().index(d));break}})}a.ajaxForm({onSubmit:function(){if("undefined"!=typeof token&&!a.find("[name=token]").length)try{a.append('<input name=token type=hidden value="'+token+'">')}catch(b){}a.find(".save").prop("disabled",!0)},onResponse:function(b){a.find(".save").prop("disabled",!1);b.isOk?a.trigger("onSuccess",[b]):b.message?alert(b.message):(a.trigger("onBeforeError",
[b]),setTipByName(d,b.errorByName)||alertError(b.errorByName))}}).bind({showAdd:c,showEdit:b}).find(".replace").click(function(){c.apply(a,[null])})})};$.fn.prepareOverlayForm=function(){return $(this).prepareForm().each(function(){var b=$(this);b.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){b.find("input,select,textarea").filter(":visible").first().focus().select()},onClose:function(){$(".formTip").hide()},closeOnClick:!1});b.bind("onSuccess",function(){b.overlay().close()})})};
$.fn.clickToggle=function(b){function c(a){a.css("cursor","auto").css("color",a.data("color")).find(".flag").remove()}b=$.extend({},{requiredClass:"",requiredMessage:"",optionalClass:"",onMessage:"",onValue:1,offMessage:"",offValue:0,requestURL:"",requestAttribute:"",requestMethod:"POST",nameClass:"",onSuccess:function(){}},b);return $(this).live({mouseenter:function(){var a=$(this);a.css("cursor","pointer");if(!a.find(".flag").length){var d=a.position(),c=a.parents("tr");c.hasClass(b.requiredClass)?
(c=c.hasClass(b.optionalClass)?b.offMessage:b.onMessage,c=$("<div class=flag>"+c+"</div>")):c=$('<div class="flag inactive">'+b.requiredMessage+"</div>");a.data("color",a.css("color")).css("color","transparent");c.css({position:"absolute",top:d.top,left:d.left,width:a.width(),height:a.height()}).appendTo(a)}},mouseleave:function(){c($(this))},click:function(){var a=$(this),d=a.parents("tr");if(d.hasClass(b.requiredClass)){var e=d.hasClass(b.optionalClass),f=e?b.offMessage:b.onMessage;c(a);if(b.nameClass?
confirm(f+" "+d.find("."+b.nameClass).text()+"?"):1){var g=getID(d[0]),h=b.requestMethod.toLowerCase(),f={token:token,id:g},g=b.requestURL.replace(0,g);b.requestAttribute&&(f[b.requestAttribute]=e?b.offValue:b.onValue);if(h)$[h](g,f,function(c){if(c.isOk){var e=d.parents("table");"undefined"!=typeof c.content&&(e.find("tbody").html(c.content),"undefined"!=typeof e.data("dataTableCustom")&&e.dataTableCustom());b.onSuccess.apply(a[0],[c])}else alertError(c.message)});else{e=[];for(key in f)e.push(key+
"="+f[key]);window.location=g+"?"+e.join("&")}}}}})};
function autoCompleteProxy(b,c,a,d,e){var f=b.find("[name="+c+"]"),g=f.prev();b.bind("showAdd",function(){f.val(d);g.val(e)}).bind("showEdit",function(a,b){g.val($.trim(b.find("."+c).text()))});$.getJSON(a,function(a){a.isOk?g.autoComplete({formatResult:function(a){return"<span rel="+a[0]+">"+a[1]+"</span>"},minCharacterCount:0,sourcePacks:a.items}).bind("itemSelect.ac",function(a,b){f.val($(b).children("span").attr("rel"))}):alert(a.message)})}
if("undefined"!=typeof $.fn.dataTable)$.fn.prepareTableOverlayForm=function(b,c){var a=b.prop("id"),d;return $(this).prepareOverlayForm().each(function(){var e=$(this).bind("onSuccess",function(a,c){b.find("tbody").html(c.content);b.dataTableCustom()}).bind("onClose",function(){$("#"+a+"_filter input").focus()}),f=e.find("[name]"),g=e.find("[name=id]");g.length||(g=$("<input name=id type=hidden>").appendTo(e));var h=$("#"+a+"_add");h.length&&h.die().live("click",function(){f.not("[type=submit],[type=button]").val("");
g.val("");e.trigger("showAdd").overlay().load()});(c||b.find("tr")).live({mouseenter:function(){var b=$(this).prop("id"),c=$("#"+a+"_info");b&&(d=c.html(),c.html("Doubleclick to edit"),$(this).css("cursor","pointer"))},mouseleave:function(){$("#"+a+"_info").html(d);$(this).css("cursor","auto")},dblclick:function(){var a=$(this),b=a.prop("id");b&&(f.not("[type=submit],[type=button],[name=id]").each(function(){var b=a.find("."+this.name),c=b.attr("rel");"undefined"==typeof c&&(c=$.trim(b.text()));this.value=
c}),g.val(getNumber(b)),e.trigger("showEdit",[a]).overlay().load())}})})},$.fn.dataTableExt.oSort["rel-numeric-asc"]=function(b,c){var a=b.match(/rel="*(-?[0-9]+)/)[1],d=c.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),d=parseFloat(d);return a<d?-1:a>d?1:0},$.fn.dataTableExt.oSort["rel-numeric-desc"]=function(b,c){var a=b.match(/rel="*(-?[0-9]+)/)[1],d=c.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),d=parseFloat(d);return a<d?1:a>d?-1:0},$.fn.dataTableExt.oSort["rel-string-asc"]=function(b,c){var a=
b.match(/rel="(.*?)"/)[1].toLowerCase(),d=c.match(/rel="(.*?)"/)[1].toLowerCase();return a<d?-1:a>d?1:0},$.fn.dataTableExt.oSort["rel-string-desc"]=function(b,c){var a=b.match(/rel="(.*?)"/)[1].toLowerCase(),d=c.match(/rel="(.*?)"/)[1].toLowerCase();return a<d?1:a>d?-1:0},$.fn.dataTableCustom=function(b){b=$.extend({},{aoColumns:null,computeTableHeight:function(){return $("#main").height()-2*$("#header").height()},onLoad:function(){}},b);return $(this).each(function(){var c=$(this),a=c.data("dataTableCustom"),
d,e,f,g;"undefined"==typeof a?(e=[],f=b.aoColumns,g=b.computeTableHeight,onLoad=b.onLoad):(d=a.$dataTable,d.fnClearTable(0),e=d.fnSettings().aaSorting,f=a.aoColumns,g=a.computeTableHeight,onLoad=a.onLoad);d=c.dataTable({aaSorting:e,aoColumns:f,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:""},sScrollY:g()});a=c.prop("id");e="resize."+a;$(window).unbind(e).bind(e,function(){d.parents(".dataTables_scrollBody").height(g());d.fnAdjustColumnSizing()});$("#"+a+"_filter input").prop("placeholder","Filter results").focus();
c.data("dataTableCustom",{$dataTable:d,aoColumns:f,computeTableHeight:g,onLoad:onLoad});onLoad.apply(c[0])})};