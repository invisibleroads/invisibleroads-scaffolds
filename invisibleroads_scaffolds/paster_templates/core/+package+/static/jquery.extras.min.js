function alertError(c){var b=c;if("object"==typeof c){var b=[],a;for(a in c)b.push(a+": "+c[a]);b=b.join("\n")}alert(b)}function getTipByName(c){var b={};c.each(function(){b[this.name||this.className]=this.title});return b}function setTipByName(c,b){var a=!1;c.each(function(){var d=b[this.name||this.className];if(d){var c=$(this);setTip(c,d);c.is(":visible")&&(c.tooltip().show(),a||(c.focus().select(),a=!0))}});return a}
function setTip(c,b){var a=c.tooltip(),d="<span class=error>"+b+"</span>";a.isShown()?a.getTip().html(d):c.prop("title",d)}
$.fn.ajaxForm=function(c){var c=$.extend({},{onSubmit:function(){},onResponse:function(){}},c),b=$("[name=ajaxForm]");b.length||(b=$('<iframe name=ajaxForm style="display:none">').appendTo("body"));return $(this).each(function(){var a=$(this);a.prop("target","ajaxForm").prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").submit(function(){c.onSubmit.apply(a[0]);if(!a.find("[type=file]").length)return $.post(a.prop("action"),a.serialize(),function(b){c.onResponse.apply(a[0],
[b])}),!1;b.one("load",function(){var d=b.contents().find("body").text(),f;try{f=eval("("+d+")")}catch(e){$.ajaxSettings.error(null,"parsererror")}c.onResponse.apply(a[0],[f])})})})};$.fn.focusNext=function(c){$(this).keydown(function(b){if(13==b.which)return c.focus(),!1})};
$.fn.prepareForm=function(){function c(){var a=$(this).find(".replace");a.length&&(a.siblings("input").prop("disabled",!0).hide(),a.show())}function b(){var a=$(this).find(".replace");a.length&&(a.hide(),a.siblings("input").prop("disabled",!1).show())}return $(this).each(function(){var a=$(this),d=a.find("[title]"),f=getTipByName(d);d.tooltip({position:"center right",tipClass:"formTip",events:{file:"focus mouseenter,blur mouseleave"},onBeforeShow:function(){var b=this.getTrigger(),d=b.prop("title");
d&&(this.getTip().html(d),b.prop("title",""));this.getConf().offset=[0,10-(b.offset().left+b.outerWidth())+(a.offset().left+a.outerWidth())]},onHide:function(){var a=this.getTrigger();a.prop("title",f[a.prop("name")||a.prop("className")])}});var e=a.find(".tabs");if(e.length){var g=e.tabs(".panes > div",{onClick:function(b,d){a.is(":visible")&&(a.find("[name]").not(":visible").each(function(){$(this).tooltip().hide()}),this.getPanes().eq(d).find("input,select,textarea").filter(":visible").first().focus())}}).data("tabs");
a.on("onBeforeError",function(a,b){for(name in b.errorByName){var d=$("[name="+name+"]").parents(".panes > div");g.click(d.parent().children().index(d));break}})}a.ajaxForm({onSubmit:function(){if("undefined"!=typeof token&&!a.find("[name=token]").length)try{a.append('<input name=token type=hidden value="'+token+'">')}catch(b){}a.find(".save").prop("disabled",!0)},onResponse:function(b){a.find(".save").prop("disabled",!1);b.isOk?a.trigger("onSuccess",[b]):b.message?alert(b.message):!1!=a.triggerHandler("onBeforeError",
[b])&&(setTipByName(d,b.errorByName)||alertError(b.errorByName))}}).on({showAdd:b,showEdit:c}).find(".replace").click(function(){b.apply(a,[null])})})};$.fn.prepareOverlayForm=function(){return $(this).prepareForm().each(function(){var c=$(this);c.overlay({mask:{color:"#000",loadSpeed:0},onLoad:function(){c.find("input,select,textarea").filter(":visible").first().focus().select()},onClose:function(){$(".formTip").hide()},closeOnClick:!1});c.on("onSuccess",function(){c.overlay().close()})})};
function clickToggle(c,b){function a(a){a.css("cursor","auto").css("color",a.data("color")).find(".flag").remove()}b=$.extend({},{tdSelector:"td",requiredClass:"",requiredMessage:"",optionalClass:"",onMessage:"",onValue:1,offMessage:"",offValue:0,requestURL:"",requestAttribute:"",requestMethod:"POST",nameClass:"",onSuccess:function(){}},b);return $(c).parents("table").on({mouseenter:function(){var a=$(this);a.css("cursor","pointer");if(!a.find(".flag").length){var c=a.position(),e=a.parents("tr");
e.hasClass(b.requiredClass)?(e=e.hasClass(b.optionalClass)?b.offMessage:b.onMessage,e=$("<div class=flag>"+e+"</div>")):e=$('<div class="flag inactive">'+b.requiredMessage+"</div>");a.data("color",a.css("color")).css("color","transparent");e.css({position:"absolute",top:c.top,left:c.left,width:a.width(),height:a.height()}).appendTo(a)}},mouseleave:function(){a($(this))},click:function(){var c=$(this),f=c.parents("tr");if(f.hasClass(b.requiredClass)){var e=f.hasClass(b.optionalClass),g=e?b.offMessage:
b.onMessage;a(c);if(b.nameClass?confirm(g+" "+f.find("."+b.nameClass).text()+"?"):1){var h=getID(f[0]),i=b.requestMethod.toLowerCase(),g={token:token,id:h},h=b.requestURL.replace(0,h);b.requestAttribute&&(g[b.requestAttribute]=e?b.offValue:b.onValue);if(i)$[i](h,g,function(a){if(a.isOk){var e=f.parents("table");"undefined"!=typeof a.content&&(e.find("tbody").html(a.content),"undefined"!=typeof e.data("dataTableCustom")&&e.dataTableCustom());b.onSuccess.apply(c[0],[a])}else alertError(a.message)});
else{e=[];for(key in g)e.push(key+"="+g[key]);window.location=h+"?"+e.join("&")}}}}},c)}
function autoCompleteProxy(c,b,a,d,f){var e=c.find("[name="+b+"]"),g=e.prev();c.on("showAdd",function(){e.val(d);g.val(f)}).on("showEdit",function(a,c){g.val($.trim(c.find("."+b).text()))});$.getJSON(a,function(a){if(a.isOk)g.autoComplete({formatResult:function(a){return"<span rel="+a[0]+">"+a[1]+"</span>"},minCharacterCount:0,sourcePacks:a.items}).on("itemSelect.ac",function(a,b){e.val($(b).children("span").attr("rel"))});else alert(a.message)})}
if("undefined"!=typeof $.fn.dataTable)$.fn.prepareTableOverlayForm=function(c,b){var a=c.prop("id"),d;return $(this).prepareOverlayForm().each(function(){var f=$(this).on("onSuccess",function(a,b){c.find("tbody").html(b.content);c.dataTableCustom()}).on("onClose",function(){$("#"+a+"_filter input").focus()}),e=f.find("[name]"),g=f.find("[name=id]");g.length||(g=$("<input name=id type=hidden>").appendTo(f));var h="#"+a+"_add";if($(h).length)$(document).off("click",h).on("click",h,function(){e.not("[type=submit],[type=button]").val("");
g.val("");f.trigger("showAdd").overlay().load()});c.on({mouseenter:function(){if($(this).prop("id")){var b=$("#"+a+"_info");d=b.html();b.html("Doubleclick to edit");$(this).css("cursor","pointer")}},mouseleave:function(){$("#"+a+"_info").html(d);$(this).css("cursor","auto")},dblclick:function(){var a=$(this),b=a.prop("id");b&&(e.not("[type=submit],[type=button],[name=id]").each(function(){var b=a.find("."+this.name),c=b.attr("rel");"undefined"==typeof c&&(c=$.trim(b.text()));this.value=c}),g.val(getNumber(b)),
f.trigger("showEdit",[a]).overlay().load())}},b||"tr")})},$.fn.dataTableExt.oSort["rel-numeric-asc"]=function(c,b){var a=c.match(/rel="*(-?[0-9]+)/)[1],d=b.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),d=parseFloat(d);return a<d?-1:a>d?1:0},$.fn.dataTableExt.oSort["rel-numeric-desc"]=function(c,b){var a=c.match(/rel="*(-?[0-9]+)/)[1],d=b.match(/rel="*(-?[0-9]+)/)[1],a=parseFloat(a),d=parseFloat(d);return a<d?1:a>d?-1:0},$.fn.dataTableExt.oSort["rel-string-asc"]=function(c,b){var a=c.match(/rel="(.*?)"/)[1].toLowerCase(),
d=b.match(/rel="(.*?)"/)[1].toLowerCase();return a<d?-1:a>d?1:0},$.fn.dataTableExt.oSort["rel-string-desc"]=function(c,b){var a=c.match(/rel="(.*?)"/)[1].toLowerCase(),d=b.match(/rel="(.*?)"/)[1].toLowerCase();return a<d?1:a>d?-1:0},$.fn.dataTableCustom=function(c){c=$.extend({},{aoColumns:null,computeTableHeight:function(){return $("#main").height()-2*$("#header").height()},onLoad:function(){}},c);return $(this).each(function(){var b=$(this),a=b.data("dataTableCustom"),d,f,e,g;"undefined"==typeof a?
(f=[],e=c.aoColumns,g=c.computeTableHeight,onLoad=c.onLoad):(d=a.$dataTable,d.fnClearTable(0),f=d.fnSettings().aaSorting,e=a.aoColumns,g=a.computeTableHeight,onLoad=a.onLoad);d=b.dataTable({aaSorting:f,aoColumns:e,bDestroy:!0,bPaginate:!1,oLanguage:{sSearch:""},sScrollY:g()});a=b.prop("id");f="resize."+a;$(window).off(f).on(f,function(){d.parents(".dataTables_scrollBody").height(g());d.fnAdjustColumnSizing()});$("#"+a+"_filter input").prop("placeholder","Filter results").focus();b.data("dataTableCustom",
{$dataTable:d,aoColumns:e,computeTableHeight:g,onLoad:onLoad});onLoad.apply(b[0])})};